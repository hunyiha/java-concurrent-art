# 第一章、Java并发机制的底层实现原理

## 上下文切换
### 如何减少上下文切换

1. 减少上下文切换的方法有无锁并发编程、CAS算法、使用最少的线程和使用协程
2. 无锁并发编程。多线程竞争时，会引起上下文切换，所以多线程处理数据时，可以用一些办法来避免使用锁，将数据Id按hash算法取模来分段，不同的线程处理不同时端的数据
3. CAS算法。Java的atomic包使用CAS算法来更新数据，面不需要加锁。Atomic变量的更新可以实现数据操作的原子性及可见性。这个是由volatile 原语及CPU的CAS指令来实现的。
4. 使用最少的线程。若任务少，但创建了很多线程来处理，这样会造成大量的线程处于等等状态。

## 死锁
### 避免死锁的几种常见方法

1. 避免一个线程同时获取多个锁 
2. 避免一个线程同时占用多个资源，尽量保证每个锁只占用一个资源 
3. 尝试使用定时锁，使用lock.tryLock(timeout)来替代使用内部锁机制 
4. 对于数据库锁，加锁和解锁必须在一个数据库连接里，否则会出现解锁失败的情况